<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>{% block title %}{% endblock %} - Flaskr</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Kanit&family=Montserrat&family=Open+Sans:wght@500&display=swap"
    rel="stylesheet">
</head>

<body>
  <div class="full-body-container">

    <div class="header-section">
      <div class="top-text">
        <div class="google-colors">
          <h1 id="google-c">C</h1>
          <h1 id="google-s">o</h1>
          <h1 id="google-4">n</h1>
          <h1 id="google-3">n</h1>
          <h1 id="google-0-1">e</h1>
          <h1 id="google-0-2">c</h1>
          <h1 id="google-c">t</h1>
          <h1 id="google-s">M</h1>
          <h1 id="google-4">e</h1>
        </div>
      </div>
    </div>
  
    <h2>Not sure where to travel next or move to? Finding the best country for you!</h2>
    <h3>For each of the questions below, please enter a number from 1 to 10, 1 being heavily disagree and 10 being
      heavily agree</h3>
    <div class="questions-section">
      <form id="questionnaire-form" onsubmit="submitForm(event)">
        <ol class="question-list">
          {% for question in questions %}
          <li class="question-item">
            <label for="question-{{ loop.index }}">{{ question }}</label>
            <input type="number" id="question-{{ loop.index }}" name="user_input[]" min="1" max="10" required>
          </li>
          {% endfor %}
        </ol>
        <button type="submit">Find my countries</button>
      </form>
    </div>
  
    <div class="output-container">
      <div id="result"></div>
    </div>
  </div>
  
  <script>
document.getElementById("questionnaire-form").addEventListener("submit", async function(event){
  event.preventDefault();
  const inputs = document.querySelectorAll("#questionnaire-form input[type='number']");
  const outputElement = document.getElementById("results");

  // Check if all inputs are filled
  let allInputsFilled = true;
  inputs.forEach(input => {
    if (input.value === "") {
      allInputsFilled = false;
    }
  });

  if (!allInputsFilled) {
    outputElement.innerHTML = "<br>Please fill in all the inputs.";
    outputElement.style.color = "red";
    return;
  } else {
    outputElement.style.color = "";
  }

  // Collect user input as an object
  const userInput = {};
  inputs.forEach(input => {
    userInput[input.name] = input.value;
  });

  // Send POST request to the Flask server
  const topCountries = await postData('/process_input', userInput);

  // Generate and display the output
  outputElement.innerHTML = `Your top 5 countries are: ${topCountries.join(', ')}`;
});



  const questions = [
    "1. How important is free choice and control over your life to you in regards to outside influence (e.g. government)?",
    "2. How important is happiness to you?",
    "3. Do you think science and technology make our lives healthier, easier, and more comfortable?",
    "4. Do you think we depend too much on science and not enough on faith.",
    "5. How important is not having any corruption in a country?",
    "6. How important is God in your life?",
    '7. In political matters, people talk of "the left" and "the right." How would you place your views on this scale, generally speaking?',
    "8. How interested would you say you are in politics?",
    "9. How important is individual human rights to you?",
    "10. Most people consider both freedom and security to be important, but if you had to choose between them, which one would you consider more important?"
  ];

  const questionContainer = document.querySelector(".question-list");
  questionContainer.innerHTML = questions.map((question, index) => `
        <li class="question-item">
        <label for="question-${index + 1}">${question} </label>
        <input type="number" id="question-${index + 1}" name="question-${index + 1}">
        </li>
    `).join('');

async function postData(url = '', data = {}) {
  const response = await fetch(url, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(data)
  });
  return response.json();
}

async function submitForm(event) {
      event.preventDefault();
      const form = document.getElementById("questionnaire-form");
      const formData = new FormData(form);
      const inputs = Array.from(document.querySelectorAll('input[type="number"]'));
      const userInput = inputs.map(input => Number(input.value));

      //const userInput = formData.getAll("user_input[]").map(Number);

      console.log(userInput);

      const response = await fetch("/api/calculate_similarity", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({user_input: userInput})
      });

      const result = await response.json();

      const resultElement = document.getElementById("result");
      resultElement.innerHTML = `Your top 5 countries are: ${result.join(", ")}.`;
    }
    const form = document.getElementById("questionnaire-form");
    form.addEventListener("submit", submitForm);

</script>

</body>